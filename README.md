# library2 -библотека книг
## Предназначение проекта
Получить базовые навыки разработки типичного клиент-серверного приложения. Предметной областью проекта является работа библиотеки. Приложение разрабатывается как сервер, предоставляющий REST api учета книг библиотеки. В приложении предусмотрена авторизация и аутентификация пользователей. Данные хранятся в базе данных postgresql .Проект не имеет визуально (front-end) составляющей.

## Используемые технологии
*	Spring Boot, JPA, Hibernate, Security
*	Swager
*	Mapstuct
*	Project Lombok
*	PostgreSQL
*	Keycloak

## Техническое описание
### Spring rest resource server
Представленный в данном репозитории проект. Создан с использованием трехслойной архитектуры.
#### Слой данных
##### Сущности/Entity
* AuthorEntity представляет собой сущность автора, имеет отношение с сущностью book как один ко многим.
* BookEntity представляет собой сущность книги, имеет отношение с сущностью author как многие к одному.
##### Репозитории
* AuthorRepository – Jpa репозиторий автора.
* BookRepository – Jpa репозиторий книги.
#### Слой бизнес логики
##### DTO
Сущности данных имеют соответствующие представления бизнес слоя(DTO), маппинг объектов осуществляется с использованием авто сгенерированных классов с использованием библиотеки mapstruct. Необходимые для генерации методы указываются в интерфейсах AtuhorMapper и BookMapper.
##### Сервисы
* Author Service - сервис работы с автором. Добавление, удаление, поиск автора.
* Book Service - сервис работы с книгами. Добавление, удаление, поиск книги.
* AuthService- сервис авторизации, использует прямое обращение к Keycloak с помощью RestTemplate, осуществляет получение JWT и refresh токенов. Осуществляет обновление токена и logout по refresh токену.
#### Сервисный слой
Доступ ко всем endpoint кроме сервеса авторизации доступен только для аутентифицированных пользователей.
* BookController –представляет собой endpoint работы с книгами (api/book/). Методы добавления и удаления книги доступны только пользователям с ролью admin.
* AuthorController- представляет собой endpoint работы с авторами (api/author/). Методы добавления и удаления автора доступны только пользователям с ролью admin.
* AuthController – endpoint аутентификации (api/auth).
  Методы подробно описаны с использованием Swagger и доступны по адресу
  http://**/swagger-ui/index.htm при запуске приложения.
### Внешние зависимости
#### Сервер учета пользователей keycloak
Основным средством контроля доступа пользователей выступает внешний сервер аутентификации keycloak. Настроен по стандарту oauth2, grantType: clientSecret. Учет пользователей осуществляется на стороне сервиса Keycloak, пользователям может быть присвоена одна из двух доступных ролей: Admin или User. Разграничений доступа к ресурсам по ролям на стороне Keycloak нет.
#### Сервер базы данных PostgreSQL
Осуществляет сохранение данных авторов и их книг. Таблицы авто генерируются и повторяют сущности, используемые приложением. Авто генерация настраивается соответствующей настройкой в property файле (jpa: hibernate: ddl-auto: update)

